# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  afa73a854f7050f4ea66b5f137a5eb43b62e0ba7
Bug 1329668 Handle partial initialized when ScriptLoader is canceled. r=baku

diff --git a/dom/workers/ScriptLoader.cpp b/dom/workers/ScriptLoader.cpp
--- a/dom/workers/ScriptLoader.cpp
+++ b/dom/workers/ScriptLoader.cpp
@@ -1574,23 +1574,27 @@ CacheCreator::ResolvedCallback(JSContext
   }
 }
 
 void
 CacheCreator::DeleteCache()
 {
   AssertIsOnMainThread();
 
-  ErrorResult rv;
+  // This is called when the load is canceled which can occur before
+  // mCacheStorage is initialized.
+  if (!mCacheStorage) {
+    return;
+  }
 
   // It's safe to do this while Cache::Match() and Cache::Put() calls are
   // running.
+  IgnoredErrorResult rv;
   RefPtr<Promise> promise = mCacheStorage->Delete(mCacheName, rv);
   if (NS_WARN_IF(rv.Failed())) {
-    rv.SuppressException();
     return;
   }
 
   // We don't care to know the result of the promise object.
   FailLoaders(NS_ERROR_FAILURE);
 }
 
 void
