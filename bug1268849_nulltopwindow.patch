# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  8c3fd523d75bd30f691ca2d6cfdad18d576392a1
Bug 1268849 Don't crash in GetServiceWorkersTestingEnabled if window is torn down and GetScriptableTop() returns nullptr. r=bz

diff --git a/dom/base/nsGlobalWindow.cpp b/dom/base/nsGlobalWindow.cpp
--- a/dom/base/nsGlobalWindow.cpp
+++ b/dom/base/nsGlobalWindow.cpp
@@ -3805,16 +3805,19 @@ nsPIDOMWindowOuter::SetServiceWorkersTes
 }
 
 bool
 nsPIDOMWindowOuter::GetServiceWorkersTestingEnabled()
 {
   // Automatically get this setting from the top level window so that nested
   // iframes get the correct devtools setting.
   nsCOMPtr<nsPIDOMWindowOuter> topWindow = GetScriptableTop();
+  if (!topWindow) {
+    return false;
+  }
   return topWindow->mServiceWorkersTestingEnabled;
 }
 
 bool
 nsPIDOMWindowInner::GetAudioCaptured() const
 {
   MOZ_ASSERT(IsInnerWindow());
   return mAudioCaptured;
