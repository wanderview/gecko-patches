# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  ef66a3b6ca2e4486f6121eeab6160edab9215be1
Bug 1333573 P8 Update test_chromeWorkerJSM.xul to expect synchronous SecurityError. r=baku

diff --git a/dom/workers/test/WorkerTest_badworker.js b/dom/workers/test/WorkerTest_badworker.js
--- a/dom/workers/test/WorkerTest_badworker.js
+++ b/dom/workers/test/WorkerTest_badworker.js
@@ -1,7 +1,1 @@
-/**
- * Any copyright is dedicated to the Public Domain.
- * http://creativecommons.org/publicdomain/zero/1.0/
- */
-onmessage = function(event) {
-  throw "Shouldn't be able to read this!";
-}
+// doesn't matter what is in here if the URL is bad
diff --git a/dom/workers/test/WorkerTest_subworker.js b/dom/workers/test/WorkerTest_subworker.js
--- a/dom/workers/test/WorkerTest_subworker.js
+++ b/dom/workers/test/WorkerTest_subworker.js
@@ -16,28 +16,18 @@ onmessage = function(event) {
   xhr.open("GET", mochitestURL, false);
   xhr.send();
 
   if (!xhr.responseText) {
     throw "Can't load script file via XHR!";
   }
 
   // We shouldn't be able to make a ChromeWorker to a non-chrome URL.
-  let worker = new ChromeWorker(mochitestURL);
-  worker.onmessage = function(event) {
-    throw event.data;
-  };
-  worker.onerror = function(event) {
-    event.preventDefault();
-
-    // And we shouldn't be able to make a regular Worker to a non-chrome URL.
-    worker = new Worker(mochitestURL);
-    worker.onmessage = function(event) {
-      throw event.data;
-    };
-    worker.onerror = function(event) {
-      event.preventDefault();
+  try{
+    new ChromeWorker(mochitestURL);
+  } catch(e) {
+    if (e.name === 'SecurityError') {
       postMessage("Done");
-    };
-    worker.postMessage("Hi");
-  };
-  worker.postMessage("Hi");
+      return;
+    }
+  }
+  throw('creating a chrome worker with a bad URL should throw a SecurityError');
 };
