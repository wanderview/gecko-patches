# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  2b07ef4f3381eafab2183a46704bed50800bede3
Bug 1375119 Don't create the AudioChannelWindow unnecessarily when checking for audio activity in the window. r=padenot

diff --git a/dom/audiochannel/AudioChannelService.cpp b/dom/audiochannel/AudioChannelService.cpp
--- a/dom/audiochannel/AudioChannelService.cpp
+++ b/dom/audiochannel/AudioChannelService.cpp
@@ -627,17 +627,22 @@ bool
 AudioChannelService::IsWindowActive(nsPIDOMWindowOuter* aWindow)
 {
   MOZ_ASSERT(NS_IsMainThread());
 
   auto* window = nsPIDOMWindowOuter::From(aWindow)->GetScriptableTop();
   if (!window) {
     return false;
   }
-  AudioChannelWindow* winData = GetOrCreateWindowData(window);
+
+  AudioChannelWindow* winData = GetWindowData(window->WindowID());
+  if (!winData) {
+    return false;
+  }
+
   return !winData->mAudibleAgents.IsEmpty();
 }
 
 void
 AudioChannelService::RefreshAgentsAudioFocusChanged(AudioChannelAgent* aAgent)
 {
   MOZ_ASSERT(aAgent);
 
