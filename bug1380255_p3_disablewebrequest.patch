# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  7d78a48745a1cf4ea59bc5a019bbc193bf80cb4e
Bug 1380255 P3 Disable channel thread retargeting when webrequest is tracing the channel. r=kmag

diff --git a/toolkit/components/extensions/webrequest/StreamFilterParent.cpp b/toolkit/components/extensions/webrequest/StreamFilterParent.cpp
--- a/toolkit/components/extensions/webrequest/StreamFilterParent.cpp
+++ b/toolkit/components/extensions/webrequest/StreamFilterParent.cpp
@@ -116,21 +116,18 @@ StreamFilterParent::Init(nsIChannel* aCh
  * nsIThreadRetargetableStreamListener
  *****************************************************************************/
 
 NS_IMETHODIMP
 StreamFilterParent::CheckListenerChain()
 {
   AssertIsMainThread();
 
-  nsCOMPtr<nsIThreadRetargetableStreamListener> trsl =
-    do_QueryInterface(mOrigListener);
-  if (trsl) {
-    return trsl->CheckListenerChain();
-  }
+  // Disable thread retargeting due to segments being delivbered out-of-order.
+  // See bug 1405286.
   return NS_ERROR_FAILURE;
 }
 
 /*****************************************************************************
  * Error handling
  *****************************************************************************/
 
 void
