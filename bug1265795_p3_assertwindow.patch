# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  1bf0d183ae9c0bfaf80b106c6fa6f3b4325ee80c
Bug 1265795 P3 Assert that controlled documents have an outer window. r=bz

diff --git a/dom/workers/ServiceWorkerManager.cpp b/dom/workers/ServiceWorkerManager.cpp
--- a/dom/workers/ServiceWorkerManager.cpp
+++ b/dom/workers/ServiceWorkerManager.cpp
@@ -2779,16 +2779,20 @@ ServiceWorkerManager::GetAllClients(nsIP
     for (auto iter = mControlledDocuments.Iter(); !iter.Done(); iter.Next()) {
       ServiceWorkerRegistrationInfo* thisRegistration = iter.UserData();
       MOZ_ASSERT(thisRegistration);
       if (!registration->mScope.Equals(thisRegistration->mScope)) {
         continue;
       }
 
       nsCOMPtr<nsIDocument> doc = do_QueryInterface(iter.Key());
+
+      // All controlled documents must have an outer window.
+      MOZ_ASSERT(doc->GetWindow());
+
       ProcessDocument(aPrincipal, doc);
     }
   }
 }
 
 void
 ServiceWorkerManager::MaybeClaimClient(nsIDocument* aDocument,
                                        ServiceWorkerRegistrationInfo* aWorkerRegistration)
