# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  81297fd0d5eb058d75a047d9ba83b4c16da6dd4a
Bug 1201160 P1 Update service worker CSS wpt tests. r=ehsan

diff --git a/testing/web-platform/mozilla/tests/service-workers/service-worker/fetch-request-css-base-url.https.html b/testing/web-platform/mozilla/tests/service-workers/service-worker/fetch-request-css-base-url.https.html
--- a/testing/web-platform/mozilla/tests/service-workers/service-worker/fetch-request-css-base-url.https.html
+++ b/testing/web-platform/mozilla/tests/service-workers/service-worker/fetch-request-css-base-url.https.html
@@ -41,16 +41,17 @@ async_test(function(t) {
                 });
               });
               worker.postMessage(
                 {port: channel.port2}, [channel.port2]);
             });
         })
       .then(function() { return with_iframe(SCOPE); })
       .then(function(f) {
+          f.postMessage('LOAD_STYLESHEET', '*');
           return testDonePromise.then(function() {
             f.remove();
             return service_worker_unregister_and_done(t, SCOPE);
           });
         })
       .catch(unreached_rejection(t));
   }, 'CSS\'s base URL must be the request URL even when fetched from other URL.');
 </script>
diff --git a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/fetch-request-css-base-url-iframe.html b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/fetch-request-css-base-url-iframe.html
--- a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/fetch-request-css-base-url-iframe.html
+++ b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/fetch-request-css-base-url-iframe.html
@@ -1,1 +1,14 @@
-<link href="./fetch-request-css-base-url-style.css" rel="stylesheet" type="text/css">
+<head>
+</head>
+<script>
+window.addEventListener('message', function(evt) {
+  if (evt.data === 'LOAD_STYLESHEET') {
+    var link = document.createElement('link');
+    link.rel = 'stylesheet';
+    link.type = 'text/css';
+    link.href = './fetch-request-css-base-url-style.css';
+    var head = document.getElementsByTagName('head')[0];
+    head.appendChild(link);
+  }
+}
+</script>
