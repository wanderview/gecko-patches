# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  03d28f2fb8d9123076e6a202396b61a4f268259f

diff --git a/dom/indexedDB/test/test_leaving_page.html b/dom/indexedDB/test/test_leaving_page.html
--- a/dom/indexedDB/test/test_leaving_page.html
+++ b/dom/indexedDB/test/test_leaving_page.html
@@ -27,16 +27,19 @@
       iframe.onload = continueToNextStep;
       yield undefined;
       is(iframe.contentWindow.location.href, $("a").href,
          "should navigate to iframe page");
       yield undefined;
       is(iframe.contentWindow.location.href, "about:blank",
          "should nagivate to about:blank");
 
+      setTimeout(continueToNextStep, 500);
+      yield undefined;
+
       let request = indexedDB.open(location, 1);
       request.onsuccess = grabEventAndContinueHandler;
       let event = yield undefined;
 
       let db = event.target.result;
       db.transaction(["mystore"]).objectStore("mystore").get(42).onsuccess =
         grabEventAndContinueHandler;
       event = yield undefined;
