# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  a3a07666d6bed0404db2934241525ca482d96612

diff --git a/ipc/glue/InputStreamUtils.cpp b/ipc/glue/InputStreamUtils.cpp
--- a/ipc/glue/InputStreamUtils.cpp
+++ b/ipc/glue/InputStreamUtils.cpp
@@ -333,16 +333,26 @@ DeserializeInputStream(const InputStream
       // child process is gone, warn and allow actor to clean up normally
       NS_WARNING("Failed to delete fd set actor.");
     }
   }
 
   return DeserializeInputStream(aValue.optionalStream(), fds);
 }
 
+already_AddRefed<nsIInputStream>
+DeserializeInputStream(const OptionalInputStreamParamsOrSendStream& aValue)
+{
+  if (aValue.type() == OptionalInputStreamParamsOrSendStream::Tvoid_t) {
+    return nullptr;
+  }
+
+  return DeserializeInputStream(aValue.get_InputStreamParamsOrSendStream());
+}
+
 AutoIPCStreamChild::AutoIPCStreamChild()
   : mInlineValue(void_t())
   , mValue(nullptr)
   , mOptionalValue(&mInlineValue)
   , mTaken(false)
 {
 }
 
diff --git a/ipc/glue/InputStreamUtils.h b/ipc/glue/InputStreamUtils.h
--- a/ipc/glue/InputStreamUtils.h
+++ b/ipc/glue/InputStreamUtils.h
@@ -38,16 +38,19 @@ DeserializeInputStream(const InputStream
 
 already_AddRefed<nsIInputStream>
 DeserializeInputStream(const OptionalInputStreamParams& aParams,
                        const nsTArray<FileDescriptor>& aFileDescriptors);
 
 already_AddRefed<nsIInputStream>
 DeserializeInputStream(const InputStreamParamsOrSendStream& aValue);
 
+already_AddRefed<nsIInputStream>
+DeserializeInputStream(const OptionalInputStreamParamsOrSendStream& aValue);
+
 // RAII helper class that serializes an nsIInputStream into an
 // InputStreamParamsOrSendStream IPC struct.  Use the Take() method when
 // passing the value to the IPC Send*() method.  If Take() is never
 // called then any actors will be cleaned up when the RAII object
 // goes out of scope.  If the stream data is being passed as a SendStream
 // actor then the copying will be started when the RAII object goes
 // out of scope.
 //
