# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  eb6655d0b35d5f415e74245718161876431d4f1b
Bug 1425965 P7 Fix dom/push/test/test_error_reporting.html to expect new console reporting mechanism. r=asuth

diff --git a/dom/push/test/test_error_reporting.html b/dom/push/test/test_error_reporting.html
--- a/dom/push/test/test_error_reporting.html
+++ b/dom/push/test/test_error_reporting.html
@@ -74,20 +74,22 @@ http://creativecommons.org/licenses/publ
     reason = await waitForDeliveryError({ type: "rejection" });
     is(reason, SpecialPowers.Ci.nsIPushErrorReporter.DELIVERY_UNHANDLED_REJECTION,
       "Should report unhandled rejections");
   });
 
   add_task(async function reportDecryptionError() {
     var message = await new Promise(resolve => {
       SpecialPowers.registerConsoleListener(message => {
-        if (!message.isScriptError) {
+        if (!message.isScriptError && !message.isConsoleEvent) {
           return;
         }
-        if (message.innerWindowID == controlledFrame.innerWindowId()) {
+        const scope = "http://mochi.test:8888/tests/dom/push/test/";
+        if (message.innerWindowID === "ServiceWorker" &&
+            message.windowID === scope) {
           SpecialPowers.postConsoleSentinel();
           resolve(message);
         }
       });
 
       var principal = SpecialPowers.wrap(document).nodePrincipal;
       pushNotifier.notifyError(registration.scope, principal, "Push error",
         SpecialPowers.Ci.nsIScriptError.errorFlag);
