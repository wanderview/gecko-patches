# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  a744726dcc4b10e35816c3fdead227b5f9eae2d0
Bug 1465670 P4 Fix test_importscript.html to expect spec behavior. r=asuth

diff --git a/dom/serviceworkers/test/importscript_worker.js b/dom/serviceworkers/test/importscript_worker.js
--- a/dom/serviceworkers/test/importscript_worker.js
+++ b/dom/serviceworkers/test/importscript_worker.js
@@ -22,16 +22,25 @@ onmessage = function(e) {
       dump("ERROR: no clients are currently controlled.\n");
     }
 
     if (!missingScriptFailed) {
       res[0].postMessage("KO");
     }
 
     try {
-      importScripts(['importscript.sjs']);
+      // new unique script should fail
+      importScripts(['importscript.sjs?unique=true']);
       res[0].postMessage("KO");
       return;
     } catch(e) {}
 
-    res[0].postMessage(counter == 2 ? "OK" : "KO");
+    try {
+      // duplicate script previously offlined should succeed
+      importScripts(['importscript.sjs']);
+    } catch(e) {
+      res[0].postMessage("KO");
+      return;
+    }
+
+    res[0].postMessage(counter == 3 ? "OK" : "KO");
   });
 };
