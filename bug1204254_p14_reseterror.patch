# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  775a87b9dcfb96f88149a9445e0c2d0380d9787f
Bug 1204254 P14 Don't call HttpChannelChild::ContinueAsyncOpen() on ResetInterception() if the channel has been canceled. r=asuth

diff --git a/netwerk/protocol/http/HttpChannelChild.cpp b/netwerk/protocol/http/HttpChannelChild.cpp
--- a/netwerk/protocol/http/HttpChannelChild.cpp
+++ b/netwerk/protocol/http/HttpChannelChild.cpp
@@ -3401,16 +3401,21 @@ HttpChannelChild::ResetInterception()
   mInterceptListener = nullptr;
 
   // The chance to intercept any further requests associated with this channel
   // (such as redirects) has passed.
   if (mRedirectMode != nsIHttpChannelInternal::REDIRECT_MODE_MANUAL) {
     mLoadFlags |= LOAD_BYPASS_SERVICE_WORKER;
   }
 
+  // If the channel has already been aborted or cancel, just stop.
+  if (NS_FAILED(mStatus)) {
+    return;
+  }
+
   // Continue with the original cross-process request
   nsresult rv = ContinueAsyncOpen();
   if (NS_WARN_IF(NS_FAILED(rv))) {
     Unused << AsyncAbort(rv);
   }
 }
 
 NS_IMETHODIMP
