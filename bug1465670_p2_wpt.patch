# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  7da4eb1db2bf6d50d6b7d6f939210a4ae44d2092
Bug 1465670 P2 Fix import-scripts-updated-flag.https.html WPT to expect NetworkError and to clear previous test state. r=asuth

diff --git a/testing/web-platform/meta/service-workers/service-worker/import-scripts-updated-flag.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/import-scripts-updated-flag.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/import-scripts-updated-flag.https.html.ini
+++ /dev/null
@@ -1,4 +0,0 @@
-[import-scripts-updated-flag.https.html]
-  [import script not previously imported]
-    expected: FAIL
-
diff --git a/testing/web-platform/tests/service-workers/service-worker/import-scripts-updated-flag.https.html b/testing/web-platform/tests/service-workers/service-worker/import-scripts-updated-flag.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/import-scripts-updated-flag.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/import-scripts-updated-flag.https.html
@@ -70,14 +70,14 @@ promise_test(t => {
   }, 'import script previously imported at worker install time');
 
 promise_test(t => {
     return register
       .then(function(worker) {
           return post_and_wait_for_reply(worker, 'message');
         })
       .then(result => {
-          assert_equals(result.error, 'TypeError');
+          assert_equals(result.error, 'NetworkError');
           assert_equals(result.value, null);
         });
   }, 'import script not previously imported');
 </script>
 </body>
diff --git a/testing/web-platform/tests/service-workers/service-worker/resources/import-scripts-updated-flag-worker.js b/testing/web-platform/tests/service-workers/service-worker/resources/import-scripts-updated-flag-worker.js
--- a/testing/web-platform/tests/service-workers/service-worker/resources/import-scripts-updated-flag-worker.js
+++ b/testing/web-platform/tests/service-workers/service-worker/resources/import-scripts-updated-flag-worker.js
@@ -1,28 +1,30 @@
 importScripts('/resources/testharness.js');
 
 let echo_output = null;
 
 // Tests importing a script that sets |echo_output| to the query string.
 function test_import(str) {
+  echo_output = null;
   importScripts('import-scripts-echo.py?msg=' + str);
   assert_equals(echo_output, str);
 }
 
 test_import('root');
 test_import('root-and-message');
 
 self.addEventListener('install', () => {
     test_import('install');
     test_import('install-and-message');
   });
 
 self.addEventListener('message', e => {
     var error = null;
+    echo_output = null;
 
     try {
       importScripts('import-scripts-echo.py?msg=' + e.data);
     } catch (e) {
       error = e && e.name;
     }
 
     e.source.postMessage({ error: error, value: echo_output });
