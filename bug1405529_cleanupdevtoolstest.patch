# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  7df627934ec4f20e90075ea796622de68822fbdc
Bug 1405529 Make test_devtools_serviceworker_interception.html close its window so its registration cleans up. r=asuth

diff --git a/dom/workers/test/serviceworkers/test_devtools_serviceworker_interception.html b/dom/workers/test/serviceworkers/test_devtools_serviceworker_interception.html
--- a/dom/workers/test/serviceworkers/test_devtools_serviceworker_interception.html
+++ b/dom/workers/test/serviceworkers/test_devtools_serviceworker_interception.html
@@ -60,17 +60,18 @@ function executeTest(aWindow) {
     // Should be intercpeted and synthesized.
     .then(_ => fetchAndCheckTimedChannel(aWindow, true, false, "fake.html"))
 
     // Should be intercepted but still fetch from network.
     .then(_ => fetchAndCheckTimedChannel(aWindow, true, true,
                                          "hello.html?ForBypassingHttpCache"))
 
     // Tear down
-    .then(_ => registration.unregister());
+    .then(_ => registration.unregister())
+    .then(_ => aWindow.close());
 }
 
 function register(aWindow, aURL, aScope) {
   return aWindow.navigator.serviceWorker.register(aURL, {scope: aScope})
     .then(r => {
       var worker = r.installing;
       return new Promise(function(aResolve) {
         worker.onstatechange = function() {
