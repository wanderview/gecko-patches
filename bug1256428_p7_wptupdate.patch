# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  b44185091d18a05fa8ae842bec570386232baef4
Bug 1256428 P7 Fix wpt update.https.html to expect TypeError per current spec. r=jdm

diff --git a/testing/web-platform/mozilla/tests/service-workers/service-worker/update.https.html b/testing/web-platform/mozilla/tests/service-workers/service-worker/update.https.html
--- a/testing/web-platform/mozilla/tests/service-workers/service-worker/update.https.html
+++ b/testing/web-platform/mozilla/tests/service-workers/service-worker/update.https.html
@@ -1,12 +1,13 @@
 <!DOCTYPE html>
 <title>Service Worker: Registration update()</title>
 <script src="/resources/testharness.js"></script>
 <script src="/resources/testharnessreport.js"></script>
+<script src="resources/testharness-helpers.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 promise_test(function(t) {
     var scope = 'resources/simple.txt';
     var worker_url = 'resources/update-worker.py';
     var expected_url = normalizeURL(worker_url);
     var registration;
     var iframe;
@@ -103,24 +104,21 @@ promise_test(function(t) {
           // We need to hold a client alive so that unregister() below doesn't
           // remove the registration before update() has had a chance to look
           // at the pending uninstall flag.
           return with_iframe(scope);
         })
       .then(function(frame) {
           iframe = frame;
 
-          return Promise.all([registration.unregister(),
-                              registration.update()]);
+          return assert_promise_rejects(
+              Promise.all([registration.unregister(), registration.update()]),
+              new TypeError(),
+              'Calling update() while the uninstalling flag is set' +
+              'should return a promise that rejects with an ' +
+              'InvalidStateError.');
         })
-      .then(
-        unreached_fulfillment(t),
-        function(e) {
-          assert_throws('InvalidStateError', function() { throw e; },
-                        'Calling update() while the uninstalling flag is set' +
-                        'should return a promise that rejects with an ' +
-                        'InvalidStateError.');
-
-          iframe.remove();
-          return t.done();
+      .then(function() {
+        iframe.remove();
+        return t.done();
         });
   }, 'Update a registration.');
 </script>
