# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  000ab0e1aaa9d881bc36460d4034f6c6566ff3a9
Bug 1238954 P2 Fix csp service worker tests to register and unregister separate scopes. r=ehsan

diff --git a/dom/security/test/csp/file_child-src_service_worker.html b/dom/security/test/csp/file_child-src_service_worker.html
--- a/dom/security/test/csp/file_child-src_service_worker.html
+++ b/dom/security/test/csp/file_child-src_service_worker.html
@@ -4,23 +4,24 @@
     <title>Bug 1045891</title>
   </head>
   <body>
   <script type="text/javascript">
     page_id = window.location.hash.substring(1);
     try {
       if ('serviceWorker' in navigator) {
         navigator.serviceWorker.register(
-            'file_child-src_service_worker.js'
-            + "#"
-            + page_id
+            'file_child-src_service_worker.js',
+            { scope: './' + page_id + '/' }
             ).then(function(reg)
               {
                 // registration worked
-                window.parent.postMessage({id:page_id, message:"allowed"}, 'http://mochi.test:8888');
+                reg.unregister().then(function() {
+                  window.parent.postMessage({id:page_id, message:"allowed"}, 'http://mochi.test:8888');
+                });
               }).catch(function(error) {
               // registration failed
               window.parent.postMessage({id:page_id, message:"blocked"}, 'http://mochi.test:8888');
             });
       };
     } catch(ex) {
       window.parent.postMessage({id:page_id, message:"exception"}, 'http://mochi.test:8888');
     }
