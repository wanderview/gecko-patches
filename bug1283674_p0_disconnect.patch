# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  fdcee57b4e4f66a82831ab01e61500da98a858e8
Bug 1283674 P0 Drop cached controlling ServiceWorker ref when ServiceWorkerContainer window is disconnect. r=baku

diff --git a/dom/workers/ServiceWorkerContainer.cpp b/dom/workers/ServiceWorkerContainer.cpp
--- a/dom/workers/ServiceWorkerContainer.cpp
+++ b/dom/workers/ServiceWorkerContainer.cpp
@@ -64,16 +64,17 @@ ServiceWorkerContainer::ServiceWorkerCon
 ServiceWorkerContainer::~ServiceWorkerContainer()
 {
   RemoveReadyPromise();
 }
 
 void
 ServiceWorkerContainer::DisconnectFromOwner()
 {
+  mControllerWorker = nullptr;
   RemoveReadyPromise();
   DOMEventTargetHelper::DisconnectFromOwner();
 }
 
 void
 ServiceWorkerContainer::ControllerChanged(ErrorResult& aRv)
 {
   mControllerWorker = nullptr;
