# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  03fa66a9c4e4818dc092bd824d74ce5684208d8a
Bug 1272748 Expose --enable-sm-promise config setting in mozinfo.json. r=mshal

diff --git a/build/docs/mozinfo.rst b/build/docs/mozinfo.rst
--- a/build/docs/mozinfo.rst
+++ b/build/docs/mozinfo.rst
@@ -131,16 +131,24 @@ processor
 
 release_build
    Whether this is a release build.
 
    Values are ``true`` and ``false``.
 
    Always defined.
 
+sm_promise
+   Whether spidermonkey promises have been enabled or not.  This is set
+   by adding --enable-sm-promise to the mozconfig file.
+
+   Values are ``true`` and ``false``.
+
+   Always defined.
+
 tests_enabled
    Whether tests are enabled for this build.
 
    Values are ``true`` and ``false``.
 
    Always defined.
 
 toolkit
diff --git a/python/mozbuild/mozbuild/mozinfo.py b/python/mozbuild/mozbuild/mozinfo.py
--- a/python/mozbuild/mozbuild/mozinfo.py
+++ b/python/mozbuild/mozbuild/mozinfo.py
@@ -90,16 +90,17 @@ def build_dict(config, env=os.environ):
     d['asan'] = substs.get('MOZ_ASAN') == '1'
     d['tsan'] = substs.get('MOZ_TSAN') == '1'
     d['telemetry'] = substs.get('MOZ_TELEMETRY_REPORTING') == '1'
     d['tests_enabled'] = substs.get('ENABLE_TESTS') == "1"
     d['bin_suffix'] = substs.get('BIN_SUFFIX', '')
     d['addon_signing'] = substs.get('MOZ_ADDON_SIGNING') == '1'
     d['require_signing'] = substs.get('MOZ_REQUIRE_SIGNING') == '1'
     d['official'] = bool(substs.get('MOZILLA_OFFICIAL'))
+    d['sm_promise'] = bool(substs.get('SPIDERMONKEY_PROMISE'))
 
     def guess_platform():
         if d['buildapp'] in ('browser', 'mulet'):
             p = d['os']
             if p == 'mac':
                 p = 'macosx64'
             elif d['bits'] == 64:
                 p = '{}64'.format(p)
