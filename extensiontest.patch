# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  7761fa33623249762b06d3e83c18a13761c26289

diff --git a/toolkit/components/extensions/test/mochitest/test_ext_contentscript_about_blank.html b/toolkit/components/extensions/test/mochitest/test_ext_contentscript_about_blank.html
--- a/toolkit/components/extensions/test/mochitest/test_ext_contentscript_about_blank.html
+++ b/toolkit/components/extensions/test/mochitest/test_ext_contentscript_about_blank.html
@@ -70,35 +70,37 @@ add_task(async function test_contentscri
   await extension.startup();
 
   let count = 0;
   extension.onMessage("script", script => {
     info(`script ran: ${script}`);
     count++;
   });
 
-  let win = window.open("http://example.com/" + PATH);
-  await Promise.all([
+  let p = Promise.all([
     extension.awaitMessage("all:top"),
     extension.awaitMessage("all:about:blank"),
     extension.awaitMessage("all:about:srcdoc"),
   ]);
+  let win = window.open("http://example.com/" + PATH);
+  await p;
   is(count, 3, "exactly 3 scripts ran");
   win.close();
 
-  win = window.open("http://mochi.test:8888/" + PATH);
-  await Promise.all([
+  p = Promise.all([
     extension.awaitMessage("all:top"),
     extension.awaitMessage("all:about:blank"),
     extension.awaitMessage("all:about:srcdoc"),
     extension.awaitMessage("mochi_without:top"),
     extension.awaitMessage("mochi_with:top"),
     extension.awaitMessage("mochi_with:about:blank"),
     extension.awaitMessage("mochi_with:about:srcdoc"),
   ]);
+  win = window.open("http://mochi.test:8888/" + PATH);
+  await p;
 
   let style = win.getComputedStyle(win.document.body);
   is(style.color, "rgb(255, 0, 0)", "top window text color is red");
   is(style.backgroundColor, "rgb(255, 255, 0)", "top window background is yellow");
   is(style.textAlign, "right", "top window text is right-aligned");
 
   let a_b = win.document.getElementById("a_b");
   style = a_b.contentWindow.getComputedStyle(a_b.contentDocument.body);
