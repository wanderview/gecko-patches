# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  25115bcc881af7ff45637c62e8ab3b51648e2673
Bug 1231211 P20 Don't call CancelInterception() if an error occurs in ChannelIntercepted(). r=asuth

diff --git a/dom/workers/ServiceWorkerInterceptController.cpp b/dom/workers/ServiceWorkerInterceptController.cpp
--- a/dom/workers/ServiceWorkerInterceptController.cpp
+++ b/dom/workers/ServiceWorkerInterceptController.cpp
@@ -56,26 +56,27 @@ ServiceWorkerInterceptController::Should
   // for a matching service worker.
   *aShouldIntercept = swm->IsAvailable(principal, aURI);
   return NS_OK;
 }
 
 NS_IMETHODIMP
 ServiceWorkerInterceptController::ChannelIntercepted(nsIInterceptedChannel* aChannel)
 {
+  // Note, do not cancel the interception here.  The caller will try to
+  // ResetInterception() on error.
+
   RefPtr<ServiceWorkerManager> swm = ServiceWorkerManager::GetInstance();
   if (!swm) {
-    aChannel->CancelInterception(NS_ERROR_INTERCEPTION_FAILED);
-    return NS_OK;
+    return NS_ERROR_FAILURE;
   }
 
   ErrorResult error;
   swm->DispatchFetchEvent(aChannel, error);
   if (NS_WARN_IF(error.Failed())) {
-    aChannel->CancelInterception(NS_ERROR_INTERCEPTION_FAILED);
     return error.StealNSResult();
   }
 
   return NS_OK;
 }
 
 } // namespace dom
 } // namespace mozilla
