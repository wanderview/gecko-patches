# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  feff79e5b1374439f17c5ea10a559acf1380a8d5

diff --git a/netwerk/protocol/http/InterceptedChannel.cpp b/netwerk/protocol/http/InterceptedChannel.cpp
--- a/netwerk/protocol/http/InterceptedChannel.cpp
+++ b/netwerk/protocol/http/InterceptedChannel.cpp
@@ -195,18 +195,21 @@ InterceptedChannelChrome::ResetIntercept
   mChannel->SetApplyConversion(mOldApplyConversion);
 
   nsCOMPtr<nsIURI> uri;
   mChannel->GetURI(getter_AddRefs(uri));
 
   nsresult rv = mChannel->StartRedirectChannelToURI(uri, nsIChannelEventSink::REDIRECT_INTERNAL);
   NS_ENSURE_SUCCESS(rv, rv);
 
-  mResponseBody->Close();
-  mResponseBody = nullptr;
+  if (mResponseBody) {
+    mResponseBody->Close();
+    mResponseBody = nullptr;
+  }
+
   return NS_OK;
 }
 
 NS_IMETHODIMP
 InterceptedChannelChrome::SynthesizeStatus(uint16_t aStatus, const nsACString& aReason)
 {
   if (!mSynthesizedCacheEntry) {
     return NS_ERROR_NOT_AVAILABLE;
@@ -223,17 +226,17 @@ InterceptedChannelChrome::SynthesizeHead
   }
 
   return DoSynthesizeHeader(aName, aValue);
 }
 
 NS_IMETHODIMP
 InterceptedChannelChrome::FinishSynthesizedResponse(const nsACString& aFinalURLSpec)
 {
-  if (!mChannel) {
+  if (NS_WARN_IF(!mChannel || !mResponseBody)) {
     return NS_ERROR_NOT_AVAILABLE;
   }
 
   // Make sure the cache entry's output stream is always closed.  If the
   // channel was intercepted with a null-body response then its possible
   // the synthesis completed without a stream copy operation.
   mResponseBody->Close();
 
@@ -381,18 +384,21 @@ NS_IMETHODIMP
 InterceptedChannelContent::ResetInterception()
 {
   if (!mChannel) {
     return NS_ERROR_NOT_AVAILABLE;
   }
 
   mReportCollector->FlushConsoleReports(mChannel);
 
-  mResponseBody->Close();
-  mResponseBody = nullptr;
+  if (mResponseBody) {
+    mResponseBody->Close();
+    mResponseBody = nullptr;
+  }
+
   mSynthesizedInput = nullptr;
 
   mChannel->ResetInterception();
   return NS_OK;
 }
 
 NS_IMETHODIMP
 InterceptedChannelContent::SynthesizeStatus(uint16_t aStatus, const nsACString& aReason)
@@ -412,17 +418,17 @@ InterceptedChannelContent::SynthesizeHea
   }
 
   return DoSynthesizeHeader(aName, aValue);
 }
 
 NS_IMETHODIMP
 InterceptedChannelContent::FinishSynthesizedResponse(const nsACString& aFinalURLSpec)
 {
-  if (NS_WARN_IF(!mChannel)) {
+  if (NS_WARN_IF(!mChannel || !mResponseBody)) {
     return NS_ERROR_NOT_AVAILABLE;
   }
 
   // Make sure the body output stream is always closed.  If the channel was
   // intercepted with a null-body response then its possible the synthesis
   // completed without a stream copy operation.
   mResponseBody->Close();
 
