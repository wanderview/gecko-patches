# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  96518bc12af68d4e04b3856756437f59dff45a1f
Bug 1379243 P6 Override Pre/Post dispatch methods in ExternalRunnableWrapper so it can be used off main thread. r=baku

diff --git a/dom/workers/WorkerPrivate.cpp b/dom/workers/WorkerPrivate.cpp
--- a/dom/workers/WorkerPrivate.cpp
+++ b/dom/workers/WorkerPrivate.cpp
@@ -239,16 +239,29 @@ public:
 
   NS_DECL_ISUPPORTS_INHERITED
 
 private:
   ~ExternalRunnableWrapper()
   { }
 
   virtual bool
+  PreDispatch(WorkerPrivate* aWorkerPrivate) override
+  {
+    // Silence bad assertions.
+    return true;
+  }
+
+  virtual void
+  PostDispatch(WorkerPrivate* aWorkerPrivate, bool aDispatchResult) override
+  {
+    // Silence bad assertions.
+  }
+
+  virtual bool
   WorkerRun(JSContext* aCx, WorkerPrivate* aWorkerPrivate) override
   {
     nsresult rv = mWrappedRunnable->Run();
     if (NS_FAILED(rv)) {
       if (!JS_IsExceptionPending(aCx)) {
         Throw(aCx, rv);
       }
       return false;
