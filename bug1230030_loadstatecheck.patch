# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  1ec3a3ff68f2d1a54e6ed33e926c28fee286bdf1
Bug 1230030 Don't replace active worker unnecessarly after saving registration in e10s mode. r=ehsan

diff --git a/dom/workers/ServiceWorkerManager.cpp b/dom/workers/ServiceWorkerManager.cpp
--- a/dom/workers/ServiceWorkerManager.cpp
+++ b/dom/workers/ServiceWorkerManager.cpp
@@ -2917,18 +2917,20 @@ ServiceWorkerManager::LoadRegistration(
   }
 
   RefPtr<ServiceWorkerRegistrationInfo> registration =
     GetRegistration(principal, aRegistration.scope());
   if (!registration) {
     registration = CreateNewRegistration(aRegistration.scope(), principal);
   } else {
     RefPtr<ServiceWorkerInfo> newest = registration->Newest();
+    // If the script spec matches and our active worker state matches our
+    // expectations for a "current worker", then we are done.
     if (newest && newest->ScriptSpec() == aRegistration.scriptSpec() &&
-        !!registration->mActiveWorker == aRegistration.currentWorkerURL().IsEmpty()) {
+        !registration->mActiveWorker == aRegistration.currentWorkerURL().IsEmpty()) {
       // No needs for updates.
       return;
     }
   }
 
   const nsCString& currentWorkerURL = aRegistration.currentWorkerURL();
   if (!currentWorkerURL.IsEmpty()) {
     registration->mActiveWorker =
