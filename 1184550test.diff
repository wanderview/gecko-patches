# HG changeset patch
# Parent  eccc2a03608193972aa3e466082427dbbfd2b756
Bug 1184550 - Request constructor should always throw if used flag is set, even if body is null
Adds a mochitest for bug 1184550
r=bkelly

diff --git a/dom/tests/mochitest/fetch/test_request.js b/dom/tests/mochitest/fetch/test_request.js
--- a/dom/tests/mochitest/fetch/test_request.js
+++ b/dom/tests/mochitest/fetch/test_request.js
@@ -126,2 +126,15 @@ function testBug1109574() {
 
+// Bug 1184550 - Request constructor should always throw if used flag is set,
+// even if body is null
+function testBug1184550() {
+  var req = new Request("", { method: 'post', body: "Test" });
+  fetch(req);
+  ok(req.bodyUsed, "Request body should be used immediately after fetch()");
+  return fetch(req).then(function(resp) {
+    ok(false, "Second fetch with same request should fail.");
+  }).catch(function(err) {
+    is(err.name, 'TypeError', "Second fetch with same request should fail.");
+  });
+}
+
 function testHeaderGuard() {
@@ -502,2 +515,3 @@ function runTest() {
   testBug1109574();
+  testBug1184550();
   testHeaderGuard();
