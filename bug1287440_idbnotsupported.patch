# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  2f9e69c982f1e67887a1834b36ff0af4ababb3af
Bug 1287440 Make window.indexedDB return null instead of throwing when cookies are disabled. r=khuey

diff --git a/dom/indexedDB/IDBFactory.cpp b/dom/indexedDB/IDBFactory.cpp
--- a/dom/indexedDB/IDBFactory.cpp
+++ b/dom/indexedDB/IDBFactory.cpp
@@ -335,17 +335,17 @@ IDBFactory::AllowedForWindowInternal(nsP
 
   nsContentUtils::StorageAccess access =
     nsContentUtils::StorageAllowedForWindow(aWindow);
 
   // the factory callsite records whether the browser is in private browsing.
   // and thus we don't have to respect that setting here. IndexedDB has no
   // concept of session-local storage, and thus ignores it.
   if (access == nsContentUtils::StorageAccess::eDeny) {
-    return NS_ERROR_DOM_SECURITY_ERR;
+    return NS_ERROR_DOM_NOT_SUPPORTED_ERR;
   }
 
   nsCOMPtr<nsIScriptObjectPrincipal> sop = do_QueryInterface(aWindow);
   MOZ_ASSERT(sop);
 
   nsCOMPtr<nsIPrincipal> principal = sop->GetPrincipal();
   if (NS_WARN_IF(!principal)) {
     return NS_ERROR_DOM_INDEXEDDB_UNKNOWN_ERR;
