# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  842e07018b4feb1da2bfe3eb5fc2417b3b867e19
Bug 1361754 Don't propagate Navigator object on document.open() any more. r=mrbkap

diff --git a/dom/base/nsGlobalWindow.cpp b/dom/base/nsGlobalWindow.cpp
--- a/dom/base/nsGlobalWindow.cpp
+++ b/dom/base/nsGlobalWindow.cpp
@@ -3142,25 +3142,16 @@ nsGlobalWindow::SetNewDocument(nsIDocume
       mCreatingInnerWindow = false;
       createdInnerWindow = true;
 
       NS_ENSURE_SUCCESS(rv, rv);
     }
 
     if (currentInner && currentInner->GetWrapperPreserveColor()) {
       if (oldDoc == aDocument) {
-        // Move the navigator from the old inner window to the new one since
-        // this is a document.write. This is safe from a same-origin point of
-        // view because document.write can only be used by the same origin.
-        newInnerWindow->mNavigator = currentInner->mNavigator;
-        currentInner->mNavigator = nullptr;
-        if (newInnerWindow->mNavigator) {
-          newInnerWindow->mNavigator->SetWindow(newInnerWindow->AsInner());
-        }
-
         // Make a copy of the old window's performance object on document.open.
         // Note that we have to force eager creation of it here, because we need
         // to grab the current document channel and whatnot before that changes.
         currentInner->AsInner()->CreatePerformanceObjectIfNeeded();
         if (currentInner->mPerformance) {
           newInnerWindow->mPerformance =
             Performance::CreateForMainThread(newInnerWindow->AsInner(),
                                              currentInner->mPerformance->GetDOMTiming(),
diff --git a/testing/web-platform/meta/html/dom/dynamic-markup-insertion/opening-the-input-stream/009.html.ini b/testing/web-platform/meta/html/dom/dynamic-markup-insertion/opening-the-input-stream/009.html.ini
--- a/testing/web-platform/meta/html/dom/dynamic-markup-insertion/opening-the-input-stream/009.html.ini
+++ b/testing/web-platform/meta/html/dom/dynamic-markup-insertion/opening-the-input-stream/009.html.ini
@@ -1,11 +1,8 @@
 [009.html]
   type: testharness
-  [document.open replacing singleton navigator]
-    expected: FAIL
-
   [document.open replacing singleton sessionStorage]
     expected: FAIL
 
   [document.open replacing singleton localStorage]
     expected: FAIL
 
