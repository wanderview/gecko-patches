# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  b04c69f0e4e3f11aba6d5f98b53c3b1f46a6f948
Bug 1363848 P4 Only set LOAD_BYPASS_SERVICE_WORKER when resetting the child channel if we're not in "manual" redirect mode. r=dragana

diff --git a/netwerk/protocol/http/HttpChannelChild.cpp b/netwerk/protocol/http/HttpChannelChild.cpp
--- a/netwerk/protocol/http/HttpChannelChild.cpp
+++ b/netwerk/protocol/http/HttpChannelChild.cpp
@@ -3240,17 +3240,19 @@ HttpChannelChild::ResetInterception()
 
   if (mInterceptListener) {
     mInterceptListener->Cleanup();
   }
   mInterceptListener = nullptr;
 
   // The chance to intercept any further requests associated with this channel
   // (such as redirects) has passed.
-  mLoadFlags |= LOAD_BYPASS_SERVICE_WORKER;
+  if (mRedirectMode != nsIHttpChannelInternal::REDIRECT_MODE_MANUAL) {
+    mLoadFlags |= LOAD_BYPASS_SERVICE_WORKER;
+  }
 
   // Continue with the original cross-process request
   nsresult rv = ContinueAsyncOpen();
   if (NS_WARN_IF(NS_FAILED(rv))) {
     Unused << AsyncAbort(rv);
   }
 }
 
