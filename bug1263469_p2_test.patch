# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  d62963756d9a9d19cbbb5d8f3dd3c7cfa8fdef88
Bug 1263469 P2 Validate FetchEvent.request.cache in refresh mochitest. r=ehsan

diff --git a/dom/workers/test/serviceworkers/force_refresh_worker.js b/dom/workers/test/serviceworkers/force_refresh_worker.js
--- a/dom/workers/test/serviceworkers/force_refresh_worker.js
+++ b/dom/workers/test/serviceworkers/force_refresh_worker.js
@@ -14,12 +14,20 @@ self.addEventListener('install', functio
   );
 });
 
 self.addEventListener('fetch', function (event) {
   event.respondWith(
     caches.open(name).then(function(cache) {
       return cache.match(event.request);
     }).then(function(response) {
+      // If this is one of our primary cached responses, then the window
+      // must have generated the request via a normal window reload.  That
+      // should be detectable in the event.request.cache attribute.
+      if (response && event.request.cache !== 'no-cache') {
+        dump('### ### FetchEvent.request.cache is "' + event.request.cache +
+             '" instead of expected "no-cache"\n');
+        return Response.error();
+      }
       return response || fetch(event.request);
     })
   );
 });
