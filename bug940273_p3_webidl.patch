# HG changeset patch
# Parent cb73b5c5767638a52d51922bb53e358fae5eab24
# User Ben Kelly <ben@wanderview.com>
Bug 940273 P3 Service Worker Cache webidl.

diff --git a/dom/webidl/Cache.webidl b/dom/webidl/Cache.webidl
new file mode 100644
--- /dev/null
+++ b/dom/webidl/Cache.webidl
@@ -0,0 +1,48 @@
+/* -*- Mode: IDL; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,
+ * You can obtain one at http://mozilla.org/MPL/2.0/.
+ *
+ * The origin of this IDL file is
+ * http://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html
+ *
+ */
+
+[Exposed=(Window,Worker),
+ Func="mozilla::dom::cache::Cache::PrefEnabled"]
+interface Cache {
+  [Throws]
+  Promise<Response> match((Request or USVString) request,
+                          optional QueryParams params);
+  [Throws]
+  Promise<sequence<Response>> matchAll(optional (Request or USVString) request,
+                                       optional QueryParams params);
+  [Throws]
+  Promise<Response> add((Request or USVString) request);
+  [Throws]
+  Promise<sequence<Response>> addAll(sequence<(Request or USVString)> requests);
+  [Throws]
+  Promise<Response> put((Request or USVString) request,
+                        Response response);
+  [Throws]
+  Promise<boolean> delete((Request or USVString) request,
+                          optional QueryParams params);
+  [Throws]
+  Promise<sequence<Request>> keys(optional (Request or USVString) request,
+                                  optional QueryParams params);
+};
+
+dictionary QueryParams {
+  boolean ignoreSearch;
+  boolean ignoreMethod;
+  boolean ignoreVary;
+  boolean prefixMatch;
+  DOMString cacheName;
+};
+
+dictionary CacheBatchOperation {
+  DOMString type;
+  Request request;
+  Response response;
+  QueryParams matchParams;
+};
diff --git a/dom/webidl/CacheStorage.webidl b/dom/webidl/CacheStorage.webidl
new file mode 100644
--- /dev/null
+++ b/dom/webidl/CacheStorage.webidl
@@ -0,0 +1,26 @@
+/* -*- Mode: IDL; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,
+ * You can obtain one at http://mozilla.org/MPL/2.0/.
+ *
+ * The origin of this IDL file is
+ * http://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html
+ *
+ */
+
+[Exposed=(Window,Worker),
+ Func="mozilla::dom::cache::CacheStorage::PrefEnabled"]
+interface CacheStorage {
+   [Throws] Promise<Response> match((Request or USVString) request,
+                                    optional QueryParams params);
+   [Throws] Promise<boolean> has(DOMString cacheName);
+   [Throws] Promise<Cache> open(DOMString cacheName);
+   [Throws] Promise<boolean> delete(DOMString cacheName);
+   [Throws] Promise<sequence<DOMString>> keys();
+};
+
+[NoInterfaceObject, Exposed=(Window,Worker)]
+interface GlobalCaches {
+  [Throws, Func="mozilla::dom::cache::CacheStorage::PrefEnabled"]
+  readonly attribute CacheStorage caches;
+};
diff --git a/dom/webidl/moz.build b/dom/webidl/moz.build
--- a/dom/webidl/moz.build
+++ b/dom/webidl/moz.build
@@ -52,16 +52,18 @@ WEBIDL_FILES = [
     'BatteryManager.webidl',
     'BeforeAfterKeyboardEvent.webidl',
     'BeforeUnloadEvent.webidl',
     'BiquadFilterNode.webidl',
     'Blob.webidl',
     'BoxObject.webidl',
     'BrowserElement.webidl',
     'BrowserElementDictionaries.webidl',
+    'Cache.webidl',
+    'CacheStorage.webidl',
     'CallsList.webidl',
     'CameraCapabilities.webidl',
     'CameraControl.webidl',
     'CameraManager.webidl',
     'CameraUtil.webidl',
     'CanvasRenderingContext2D.webidl',
     'CaretPosition.webidl',
     'CDATASection.webidl',
