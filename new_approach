# HG changeset patch
# Parent da0512893f3e06129acad105d6211500fc38bebc
# User Ben Kelly <ben@wanderview.com>
diff --git a/ipc/glue/BackgroundImpl.cpp b/ipc/glue/BackgroundImpl.cpp
--- a/ipc/glue/BackgroundImpl.cpp
+++ b/ipc/glue/BackgroundImpl.cpp
@@ -426,16 +426,22 @@ private:
         ChildImpl* actor;
         threadLocalInfo->mActor.forget(&actor);
 
         MOZ_ASSERT(!actor->mActorDestroyed);
         MOZ_ASSERT(!actor->mSelfRefWhileWaitingForActorDestroy);
         actor->mSelfRefWhileWaitingForActorDestroy = dont_AddRef(actor);
 
         actor->Close();
+
+        while (!actor->mActorDestroyed) {
+          if (NS_WARN_IF(!NS_ProcessNextEvent(nullptr, true /* aMayWait */))) {
+            break;
+          }
+        }
       }
       delete threadLocalInfo;
     }
   }
 
   static void
   DispatchFailureCallback(nsIEventTarget* aEventTarget);
 
