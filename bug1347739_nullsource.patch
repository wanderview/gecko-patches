# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  dd2f2db1f87aa31e98d204a707dcfd6457a6c696
Bug 1347739 Don't crash if an ExtendableMessageEvent object has a null source. r=asuth

diff --git a/dom/workers/ServiceWorkerEvents.cpp b/dom/workers/ServiceWorkerEvents.cpp
--- a/dom/workers/ServiceWorkerEvents.cpp
+++ b/dom/workers/ServiceWorkerEvents.cpp
@@ -1186,17 +1186,18 @@ ExtendableMessageEvent::GetSource(Nullab
 {
   if (mClient) {
     aValue.SetValue().SetAsClient() = mClient;
   } else if (mServiceWorker) {
     aValue.SetValue().SetAsServiceWorker() = mServiceWorker;
   } else if (mMessagePort) {
     aValue.SetValue().SetAsMessagePort() = mMessagePort;
   } else {
-    MOZ_CRASH("Unexpected source value");
+    // nullptr source is possible for manually constructed event
+    aValue.SetNull();
   }
 }
 
 /* static */ already_AddRefed<ExtendableMessageEvent>
 ExtendableMessageEvent::Constructor(const GlobalObject& aGlobal,
                                     const nsAString& aType,
                                     const ExtendableMessageEventInit& aOptions,
                                     ErrorResult& aRv)
