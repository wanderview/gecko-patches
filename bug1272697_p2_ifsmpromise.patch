# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  9c593dc973d6f2621bcc46ed26dd51a6e9a08662
Bug 1272697 P2 Make ReadableStream conditional on SPIDERMONKEY_PROMISE config setting. r=till

diff --git a/js/src/moz.build b/js/src/moz.build
--- a/js/src/moz.build
+++ b/js/src/moz.build
@@ -739,31 +739,33 @@ selfhosted.inputs = [
     'builtin/Generator.js',
     'builtin/Intl.js',
     'builtin/IntlData.js',
     'builtin/Iterator.js',
     'builtin/Map.js',
     'builtin/Module.js',
     'builtin/Number.js',
     'builtin/Object.js',
-    'builtin/ReadableStream.js',
     'builtin/Reflect.js',
     'builtin/RegExp.js',
     'builtin/RegExpGlobalReplaceOpt.h.js',
     'builtin/RegExpLocalReplaceOpt.h.js',
     'builtin/String.js',
     'builtin/Set.js',
     'builtin/Sorting.js',
     'builtin/TypedArray.js',
     'builtin/TypedObject.js',
     'builtin/WeakSet.js'
 ]
 
 if CONFIG['SPIDERMONKEY_PROMISE']:
-    selfhosted.inputs += ['builtin/Promise.js']
+    selfhosted.inputs += [
+      'builtin/Promise.js',
+      'builtin/ReadableStream.js',
+    ]
 
 if CONFIG['JS_HAS_CTYPES']:
     if CONFIG['MOZ_SYSTEM_FFI']:
         CXXFLAGS += CONFIG['MOZ_FFI_CFLAGS']
     else:
         # Windows needs this to be linked with a static library.
         DEFINES['FFI_BUILDING'] = True
 
diff --git a/testing/web-platform/meta/streams/__dir__.ini b/testing/web-platform/meta/streams/__dir__.ini
new file mode 100644
--- /dev/null
+++ b/testing/web-platform/meta/streams/__dir__.ini
@@ -0,0 +1,2 @@
+disabled:
+  if not sm_promise: foo
