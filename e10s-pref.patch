# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  5f5a740dae191e9f0cd055076cb8dfa1563a91e0

diff --git a/dom/serviceworkers/ServiceWorkerUtils.cpp b/dom/serviceworkers/ServiceWorkerUtils.cpp
--- a/dom/serviceworkers/ServiceWorkerUtils.cpp
+++ b/dom/serviceworkers/ServiceWorkerUtils.cpp
@@ -17,19 +17,21 @@ namespace dom {
 bool
 ServiceWorkerParentInterceptEnabled()
 {
   static bool sInit = false;
   static Atomic<bool> sEnabled;
 
   if (!sInit) {
     MOZ_ASSERT(NS_IsMainThread());
+    // TODO: Why do we not see the correct pref value in the content process
+    //       immediately if we don't set this to default value "true"?
     Preferences::AddAtomicBoolVarCache(&sEnabled,
                                        "dom.serviceWorkers.parent_intercept",
-                                       false);
+                                       true);
     sInit = true;
   }
 
   return sEnabled;
 }
 
 bool
 ServiceWorkerRegistrationDataIsValid(const ServiceWorkerRegistrationData& aData)
diff --git a/testing/profiles/common/user.js b/testing/profiles/common/user.js
--- a/testing/profiles/common/user.js
+++ b/testing/profiles/common/user.js
@@ -32,8 +32,9 @@ user_pref("extensions.legacy.enabled", t
 user_pref("extensions.update.enabled", false);
 // Disable useragent updates.
 user_pref("general.useragent.updates.enabled", false);
 user_pref("hangmonitor.timeout", 0); // no hang monitor
 user_pref("media.gmp-manager.updateEnabled", false);
 // Make enablePrivilege continue to work for test code. :-(
 user_pref("security.turn_off_all_security_so_that_viruses_can_take_over_this_computer", true);
 user_pref("xpinstall.signatures.required", false);
+user_pref("dom.serviceWorkers.parent_intercept", true);
diff --git a/testing/web-platform/meta/service-workers/__dir__.ini b/testing/web-platform/meta/service-workers/__dir__.ini
--- a/testing/web-platform/meta/service-workers/__dir__.ini
+++ b/testing/web-platform/meta/service-workers/__dir__.ini
@@ -1,2 +1,3 @@
 prefs: [javascript.options.streams:true,
-        dom.streams.enabled:true]
+        dom.streams.enabled:true,
+        dom.serviceWorkers.parent_intercept:true]
