# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  c6867a2c9797b94a367b163ee73970d23aeba453
Bug 1429029 Force browser_storage_permission.js to use a single content process to avoid multi-e10s service worker propagation races. r=asuth

diff --git a/dom/workers/test/serviceworkers/browser_storage_permission.js b/dom/workers/test/serviceworkers/browser_storage_permission.js
--- a/dom/workers/test/serviceworkers/browser_storage_permission.js
+++ b/dom/workers/test/serviceworkers/browser_storage_permission.js
@@ -5,16 +5,19 @@ const { interfaces: Ci } = Components;
 const BASE_URI = "http://mochi.test:8888/browser/dom/workers/test/serviceworkers/";
 const PAGE_URI = BASE_URI + "empty.html";
 const SCOPE = PAGE_URI + "?storage_permission";
 const SW_SCRIPT = BASE_URI + "empty.js";
 
 
 add_task(async function setup() {
   await SpecialPowers.pushPrefEnv({"set": [
+    // Until the e10s refactor is complete, use a single process to avoid
+    // service worker propagation race.
+    ["dom.ipc.processCount", 1],
     ["dom.serviceWorkers.enabled", true],
     ["dom.serviceWorkers.testing.enabled", true],
   ]});
 
   let tab = BrowserTestUtils.addTab(gBrowser, PAGE_URI);
   let browser = gBrowser.getBrowserForTab(tab);
   await BrowserTestUtils.browserLoaded(browser);
 
