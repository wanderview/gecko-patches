# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  f0aefd6ff301a9d4c5812746ec9ad70f35993c7d

diff --git a/dom/base/nsGlobalWindow.cpp b/dom/base/nsGlobalWindow.cpp
--- a/dom/base/nsGlobalWindow.cpp
+++ b/dom/base/nsGlobalWindow.cpp
@@ -11850,17 +11850,27 @@ nsGlobalWindow::NewIsFrozen() const
   bool frozen =  mFreezeDepth != 0;
   MOZ_ASSERT_IF(frozen, NewIsSuspended());
   return frozen;
 }
 
 void
 nsGlobalWindow::NewSyncSuspendAndFreezeStateToParentWindow()
 {
-  nsPIDOMWindowOuter* parentOuter = GetParentInternal();
+  nsPIDOMWindowOuter* outer = GetOuterWindow();
+  if (!outer) {
+    return;
+  }
+
+  nsCOMPtr<Element> frame = outer->GetFrameElementInternal();
+  if (!frame) {
+    return;
+  }
+
+  nsPIDOMWindowOuter* parentOuter = frame->OwnerDoc()->GetWindow();
   if (!parentOuter) {
     return;
   }
 
   nsGlobalWindow* parentInner =
     nsGlobalWindow::Cast(parentOuter->GetCurrentInnerWindow());
   if (!parentInner) {
     return;
