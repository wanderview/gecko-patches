# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  384e78914f9fca754f080059694e64e169c6fd5f
Bug 1256428 P14 Remove dead code in SeviceWorkerUpdateJob.cpp. r=jdm

diff --git a/dom/workers/ServiceWorkerUpdateJob.cpp b/dom/workers/ServiceWorkerUpdateJob.cpp
--- a/dom/workers/ServiceWorkerUpdateJob.cpp
+++ b/dom/workers/ServiceWorkerUpdateJob.cpp
@@ -311,50 +311,36 @@ ServiceWorkerUpdateJob2::ComparisonResul
   if (maxScopeURI) {
     rv = GetRequiredScopeStringPrefix(maxScopeURI, maxPrefix, eUsePath);
     if (NS_WARN_IF(NS_FAILED(rv))) {
       FailUpdateJob(NS_ERROR_DOM_SECURITY_ERR);
       return;
     }
   }
 
-  RefPtr<ServiceWorkerManager> swm = ServiceWorkerManager::GetInstance();
-
   if (!StringBeginsWith(mRegistration->mScope, maxPrefix)) {
     nsXPIDLString message;
     NS_ConvertUTF8toUTF16 reportScope(mRegistration->mScope);
     NS_ConvertUTF8toUTF16 reportMaxPrefix(maxPrefix);
     const char16_t* params[] = { reportScope.get(), reportMaxPrefix.get() };
 
     rv = nsContentUtils::FormatLocalizedString(nsContentUtils::eDOM_PROPERTIES,
                                                "ServiceWorkerScopePathMismatch",
                                                params, message);
     NS_WARN_IF_FALSE(NS_SUCCEEDED(rv), "Failed to format localized string");
+    RefPtr<ServiceWorkerManager> swm = ServiceWorkerManager::GetInstance();
     swm->ReportToAllClients(mScope,
                             message,
                             EmptyString(),
                             EmptyString(), 0, 0,
                             nsIScriptError::errorFlag);
     FailUpdateJob(NS_ERROR_DOM_SECURITY_ERR);
     return;
   }
 
-  nsAutoCString scopeKey;
-  rv = swm->PrincipalToScopeKey(mRegistration->mPrincipal, scopeKey);
-  if (NS_WARN_IF(NS_FAILED(rv))) {
-    FailUpdateJob(NS_ERROR_FAILURE);
-    return;
-  }
-
-  ServiceWorkerManager::RegistrationDataPerPrincipal* data;
-  if (!swm->mRegistrationInfos.Get(scopeKey, &data)) {
-    FailUpdateJob(NS_ERROR_FAILURE);
-    return;
-  }
-
   MOZ_ASSERT(!mServiceWorker);
   mServiceWorker = new ServiceWorkerInfo(mRegistration->mPrincipal,
                                          mRegistration->mScope,
                                          mScriptSpec, aNewCacheName);
 
   nsMainThreadPtrHandle<ServiceWorkerUpdateJob2> handle(
       new nsMainThreadPtrHolder<ServiceWorkerUpdateJob2>(this));
   RefPtr<LifeCycleEventCallback> callback = new ContinueUpdateRunnable(handle);
