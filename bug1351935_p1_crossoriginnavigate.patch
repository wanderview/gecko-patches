# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  60d7a0496a3673450ddbc37ec387525148c32604
Bug 1351935 P1 Make Client.navigate() support cross-origin loads. r=smaug

diff --git a/dom/workers/ServiceWorkerWindowClient.cpp b/dom/workers/ServiceWorkerWindowClient.cpp
--- a/dom/workers/ServiceWorkerWindowClient.cpp
+++ b/dom/workers/ServiceWorkerWindowClient.cpp
@@ -375,21 +375,16 @@ public:
     nsCOMPtr<nsIURI> baseUrl;
     nsCOMPtr<nsIURI> url;
     nsresult rv = ParseUrl(getter_AddRefs(baseUrl), getter_AddRefs(url));
 
     if (NS_WARN_IF(NS_FAILED(rv))) {
       return RejectPromise(NS_ERROR_TYPE_ERR);
     }
 
-    rv = principal->CheckMayLoad(url, true, false);
-    if (NS_WARN_IF(NS_FAILED(rv))) {
-      return RejectPromise(rv);
-    }
-
     nsGlobalWindow* window;
     rv = Navigate(url, principal, &window);
     if (NS_WARN_IF(NS_FAILED(rv))) {
       return RejectPromise(rv);
     }
 
     nsCOMPtr<nsIDocShell> docShell = window->GetDocShell();
     nsCOMPtr<nsIWebProgress> webProgress = do_GetInterface(docShell);
@@ -497,18 +492,16 @@ private:
     }
 
     nsCOMPtr<nsIDocShellLoadInfo> loadInfo;
     nsresult rv = docShell->CreateLoadInfo(getter_AddRefs(loadInfo));
     if (NS_WARN_IF(NS_FAILED(rv))) {
       return rv;
     }
 
-    loadInfo->SetTriggeringPrincipal(aPrincipal);
-    loadInfo->SetReferrer(doc->GetOriginalURI());
     loadInfo->SetReferrerPolicy(doc->GetReferrerPolicy());
     loadInfo->SetLoadType(nsIDocShellLoadInfo::loadStopContentAndReplace);
     loadInfo->SetSourceDocShell(docShell);
     rv =
       docShell->LoadURI(aUrl, loadInfo, nsIWebNavigation::LOAD_FLAGS_NONE, true);
 
     if (NS_WARN_IF(NS_FAILED(rv))) {
       return rv;
