# HG changeset patch
# Parent 786dd202bdd02c743cd856e8cfe0dfc62fc2fbb2
# User Ben Kelly <ben@wanderview.com>
Bug 940273 Part 2: CacheStorage webidl and stubs

diff --git a/dom/bindings/Bindings.conf b/dom/bindings/Bindings.conf
--- a/dom/bindings/Bindings.conf
+++ b/dom/bindings/Bindings.conf
@@ -176,16 +176,22 @@ DOMInterfaces = {
 },
 
 'Cache': {
     'headerFile': 'mozilla/dom/Cache.h',
     'nativeType': 'mozilla::dom::Cache',
     'workers': True,
 },
 
+'CacheStorage': {
+    'headerFile': 'mozilla/dom/CacheStorage.h',
+    'nativeType': 'mozilla::dom::CacheStorage',
+    'workers': True,
+},
+
 'CameraCapabilities': {
     'nativeType': 'mozilla::dom::CameraCapabilities',
     'headerFile': 'DOMCameraCapabilities.h'
 },
 
 'CameraControl': {
     'nativeType': 'mozilla::nsDOMCameraControl',
     'headerFile': 'DOMCameraControl.h',
diff --git a/dom/webidl/CacheStorage.webidl b/dom/webidl/CacheStorage.webidl
new file mode 100644
--- /dev/null
+++ b/dom/webidl/CacheStorage.webidl
@@ -0,0 +1,33 @@
+/* -*- Mode: IDL; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,
+ * You can obtain one at http://mozilla.org/MPL/2.0/.
+ *
+ * The origin of this IDL file is
+ * http://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html
+ *
+ */
+
+[Constructor(sequence<any> iterable),
+ Pref="dom.serviceWorkers.enabled"]
+interface CacheStorage {
+   Promise match(DOMString url, optional DOMString cacheName);
+   // Promise<Cache>
+   Promise get(DOMString key);
+   // Promise<boolean>
+   Promise has(DOMString key);
+   Promise set(DOMString key, Cache val);
+   Promise clear();
+   Promise delete(DOMString key);
+   void forEach(CacheStorageIterationCallback callback, optional object thisArg);
+   // Promise<sequence<any>>
+   Promise entries();
+   // Promise<sequence<DOMString>>
+   Promise keys();
+   // Promise<sequence<Cache>>
+   Promise values();
+   // Promise<unsigned long>
+   Promise size();
+};
+
+callback CacheStorageIterationCallback = void (Cache value, DOMString key, CacheStorage map);
diff --git a/dom/webidl/moz.build b/dom/webidl/moz.build
--- a/dom/webidl/moz.build
+++ b/dom/webidl/moz.build
@@ -38,16 +38,17 @@ WEBIDL_FILES = [
     'AudioStreamTrack.webidl',
     'BarProp.webidl',
     'BatteryManager.webidl',
     'BeforeUnloadEvent.webidl',
     'BiquadFilterNode.webidl',
     'Blob.webidl',
     'BrowserElementDictionaries.webidl',
     'Cache.webidl',
+    'CacheStorage.webidl',
     'CallsList.webidl',
     'CameraCapabilities.webidl',
     'CameraControl.webidl',
     'CameraManager.webidl',
     'CanvasRenderingContext2D.webidl',
     'CaretPosition.webidl',
     'CDATASection.webidl',
     'ChannelMergerNode.webidl',
