# HG changeset patch
# Parent 49a1064383b8bde886c5538b2bee03b8166ffc9f
# User Ben Kelly <ben@wanderview.com>
diff --git a/dom/workers/moz.build b/dom/workers/moz.build
--- a/dom/workers/moz.build
+++ b/dom/workers/moz.build
@@ -108,15 +108,19 @@ TEST_DIRS += [
     'test/extensions/traditional',
 ]
 
 MOCHITEST_MANIFESTS += [
     'test/mochitest.ini',
     'test/serviceworkers/mochitest.ini',
 ]
 
+BROWSER_CHROME_MANIFESTS += [
+    'test/serviceworkers/browser.ini',
+]
+
 MOCHITEST_CHROME_MANIFESTS += ['test/chrome.ini']
 
 XPCSHELL_TESTS_MANIFESTS += ['test/xpcshell/xpcshell.ini']
 
 BROWSER_CHROME_MANIFESTS += ['test/browser.ini']
 
 TEST_DIRS += ['test/gtest']
diff --git a/dom/workers/test/serviceworkers/browser.ini b/dom/workers/test/serviceworkers/browser.ini
new file mode 100644
--- /dev/null
+++ b/dom/workers/test/serviceworkers/browser.ini
@@ -0,0 +1,7 @@
+[DEFAULT]
+support-files =
+  browser_base_force_refresh.html
+  browser_cached_force_refresh.html
+
+[browser_force_refresh.js]
+skip-if = e10s
diff --git a/dom/workers/test/serviceworkers/browser_base_force_refresh.html b/dom/workers/test/serviceworkers/browser_base_force_refresh.html
new file mode 100644
--- /dev/null
+++ b/dom/workers/test/serviceworkers/browser_base_force_refresh.html
@@ -0,0 +1,18 @@
+<!--
+  Any copyright is dedicated to the Public Domain.
+  http://creativecommons.org/publicdomain/zero/1.0/
+-->
+<!DOCTYPE HTML>
+<html>
+<head>
+</head>
+<body>
+<script type="text/javascript">
+addEventListener('load', function(event) {
+  dump('### ### page load event\n');
+  var custom = new Event('baseload', { bubbles: true });
+  document.dispatchEvent(custom);
+});
+</script>
+</body>
+</html>
diff --git a/dom/workers/test/serviceworkers/browser_cached_force_refresh.html b/dom/workers/test/serviceworkers/browser_cached_force_refresh.html
new file mode 100644
--- /dev/null
+++ b/dom/workers/test/serviceworkers/browser_cached_force_refresh.html
@@ -0,0 +1,14 @@
+<!--
+  Any copyright is dedicated to the Public Domain.
+  http://creativecommons.org/publicdomain/zero/1.0/
+-->
+<!DOCTYPE HTML>
+<html>
+<head>
+</head>
+<body>
+<script type="text/javascript">
+dump("### ### hello world\n");
+</script>
+</body>
+</html>
diff --git a/dom/workers/test/serviceworkers/browser_force_refresh.js b/dom/workers/test/serviceworkers/browser_force_refresh.js
new file mode 100644
--- /dev/null
+++ b/dom/workers/test/serviceworkers/browser_force_refresh.js
@@ -0,0 +1,24 @@
+/* Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/ */
+
+var gTestRoot = getRootDirectory(gTestPath).replace("chrome://mochitests/content/",
+                                                    "http://mochi.test:8888/")
+
+function test() {
+  waitForExplicitFinish();
+  var url = gTestRoot + 'browser_base_force_refresh.html';
+  var tab = gBrowser.addTab(url);
+  gBrowser.selectedTab = tab;
+
+  addEventListener('baseload', function onBaseLoad(event) {
+    dump("### ### got base load\n");
+    ok(true);
+    gBrowser.removeTab(tab);
+    executeSoon(finish);
+  }, true, true);
+
+  tab.linkedBrowser.addEventListener('load', function onLoad(event) {
+    tab.linkedBrowser.removeEventListener('load', onLoad);
+    dump("### ### " + tab.linkedBrowser.contentWindow.location.href + "\n");
+  }, true);
+}
