# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  76238c9e1b9f7cba03bfdbff70e7d7b05b37f02f
Bug 1451913 P9 Try to avoid event listener leak test intermittents by doing more GC. r=baku

diff --git a/dom/events/test/event_leak_utils.js b/dom/events/test/event_leak_utils.js
--- a/dom/events/test/event_leak_utils.js
+++ b/dom/events/test/event_leak_utils.js
@@ -67,15 +67,16 @@ async function _eventListenerLeakStep(ta
 
   if (extra) {
     await extra(frame);
   }
 
   frame.remove();
   frame = null;
 
-  // Perform two GC'd to avoid intermittent delayed collection.
+  // Perform many GC's to avoid intermittent delayed collection.
+  await new Promise(resolve => SpecialPowers.exactGC(resolve));
   await new Promise(resolve => SpecialPowers.exactGC(resolve));
   await new Promise(resolve => SpecialPowers.exactGC(resolve));
 
   ok(!weakRef.get(), `iframe content window should be garbage collected - ${name}`);
 }
 
