# HG changeset patch
# Parent 7cb36c6a709ef1e4f235097fb17f9e776ae37169
# User Ben Kelly <ben@wanderview.com>
Bug940273 P7 interdiff 003 test the WorkerFeature


diff --git a/dom/tests/mochitest/cache/mochitest.ini b/dom/tests/mochitest/cache/mochitest.ini
--- a/dom/tests/mochitest/cache/mochitest.ini
+++ b/dom/tests/mochitest/cache/mochitest.ini
@@ -1,10 +1,12 @@
 [DEFAULT]
 support-files =
   test_cache.js
   test_cache_add.js
   test_cache_frame.html
+  test_cache_quick_close.js
   worker_driver.js
   worker_wrapper.js
 
 [test_cache.html]
 [test_cache_add.html]
+[test_cache_quick_close.html]
diff --git a/dom/tests/mochitest/cache/test_cache_quick_close.html b/dom/tests/mochitest/cache/test_cache_quick_close.html
new file mode 100644
--- /dev/null
+++ b/dom/tests/mochitest/cache/test_cache_quick_close.html
@@ -0,0 +1,22 @@
+<!-- Any copyright is dedicated to the Public Domain.
+   - http://creativecommons.org/publicdomain/zero/1.0/ -->
+<!DOCTYPE HTML>
+<html>
+<head>
+  <title>Validate Interfaces Exposed to Workers</title>
+  <script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
+  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
+  <script type="text/javascript" src="worker_driver.js"></script>
+</head>
+<body>
+<iframe id="frame"></iframe>
+<script class="testbody" type="text/javascript">
+SimpleTest.waitForExplicitFinish();
+SpecialPowers.pushPrefEnv({
+  "set": [["dom.caches.enabled", true]]
+}, function() {
+  workerTestExec("test_cache_quick_close.js");
+});
+</script>
+</body>
+</html>
diff --git a/dom/tests/mochitest/cache/test_cache_quick_close.js b/dom/tests/mochitest/cache/test_cache_quick_close.js
new file mode 100644
--- /dev/null
+++ b/dom/tests/mochitest/cache/test_cache_quick_close.js
@@ -0,0 +1,4 @@
+var promise = caches.open('closer');
+self.close();
+ok(true, 'Should not crash on close()');
+workerTestDone();
