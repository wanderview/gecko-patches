# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  fecea921d7d8a14a1ebb757bbc1adbac17af29c2
Bug 1371664 P3 Call TimeoutExecutor::SetMinimumDelay() from TimeoutManager::MaybeUpdateBackgroundState(). r=ehsan

diff --git a/dom/base/TimeoutManager.cpp b/dom/base/TimeoutManager.cpp
--- a/dom/base/TimeoutManager.cpp
+++ b/dom/base/TimeoutManager.cpp
@@ -1153,16 +1153,22 @@ TimeoutManager::Thaw()
 }
 
 void
 TimeoutManager::MaybeUpdateBackgroundState()
 {
   if (!IsBackground()) {
     ResetTimersForThrottleReduction();
   }
+
+  TimeDuration minDelay(0);
+  if (IsBackground()) {
+    minDelay = TimeDuration::FromMilliseconds(gMinBackgroundTimeoutValue);
+  }
+  mExecutor->SetMinimumDelay(minDelay);
 }
 
 bool
 TimeoutManager::IsTimeoutTracking(uint32_t aTimeoutId)
 {
   return mTrackingTimeouts.ForEachAbortable([&](Timeout* aTimeout) {
       return aTimeout->mTimeoutId == aTimeoutId;
     });
