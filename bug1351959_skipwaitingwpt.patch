# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  2f01948cacc32bc8bef4a44b3bd5570bea504588
Bug 1351959 Fix skip-waiting and other WPT tests broken by request-end-to-end.https.html. r=asuth

diff --git a/testing/web-platform/meta/service-workers/service-worker/serviceworker-message-event-historical.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/serviceworker-message-event-historical.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/serviceworker-message-event-historical.https.html.ini
+++ /dev/null
@@ -1,6 +0,0 @@
-[serviceworker-message-event-historical.https.html]
-  type: testharness
-  expected: TIMEOUT
-  [Test MessageEvent supplants ServiceWorkerMessageEvent.]
-    expected: TIMEOUT
-
diff --git a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-installed.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/skip-waiting-installed.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-installed.https.html.ini
+++ /dev/null
@@ -1,6 +0,0 @@
-[skip-waiting-installed.https.html]
-  type: testharness
-  expected: TIMEOUT
-  [Test skipWaiting when a installed worker is waiting]
-    expected: TIMEOUT
-
diff --git a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-using-registration.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/skip-waiting-using-registration.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-using-registration.https.html.ini
+++ /dev/null
@@ -1,4 +0,0 @@
-[skip-waiting-using-registration.https.html]
-  type: testharness
-  [Test skipWaiting while a client is using the registration]
-    expected: FAIL
diff --git a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-without-using-registration.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/skip-waiting-without-using-registration.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/skip-waiting-without-using-registration.https.html.ini
+++ /dev/null
@@ -1,3 +0,0 @@
-[skip-waiting-without-using-registration.https.html]
-  type: testharness
-  disabled: https://bugzilla.mozilla.org/show_bug.cgi?id=1347497
diff --git a/testing/web-platform/meta/service-workers/service-worker/skip-waiting.https.html.ini b/testing/web-platform/meta/service-workers/service-worker/skip-waiting.https.html.ini
deleted file mode 100644
--- a/testing/web-platform/meta/service-workers/service-worker/skip-waiting.https.html.ini
+++ /dev/null
@@ -1,3 +0,0 @@
-[skip-waiting.https.html]
-  type: testharness
-  disabled: https://bugzilla.mozilla.org/show_bug.cgi?id=1347497
diff --git a/testing/web-platform/tests/service-workers/service-worker/request-end-to-end.https.html b/testing/web-platform/tests/service-workers/service-worker/request-end-to-end.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/request-end-to-end.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/request-end-to-end.https.html
@@ -2,17 +2,17 @@
 <title>Service Worker: Request end-to-end</title>
 <script src="/resources/testharness.js"></script>
 <script src="/resources/testharnessreport.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 var t = async_test('Request: end-to-end');
 t.step(function() {
     var url = 'resources/request-end-to-end-worker.js';
-    var scope = 'resources/blank.html';
+    var scope = 'resources/blank.html?request-end-to-end';
     var frames = [];
 
     service_worker_unregister_and_register(t, url, scope)
       .then(onRegister)
       .catch(unreached_rejection(t));
 
     function sendMessagePort(worker) {
         var messageChannel = new MessageChannel();
diff --git a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-installed.https.html b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-installed.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-installed.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-installed.https.html
@@ -2,17 +2,17 @@
 <title>Service Worker: Skip waiting installed worker</title>
 <script src="/resources/testharness.js"></script>
 <script src="resources/testharness-helpers.js"></script>
 <script src="/resources/testharnessreport.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 
 promise_test(function(t) {
-    var scope = 'resources/blank.html';
+    var scope = 'resources/blank.html?skip-waiting-installed';
     var url1 = 'resources/empty.js';
     var url2 = 'resources/skip-waiting-installed-worker.js';
     var frame, frame_sw, service_worker, registration, onmessage, oncontrollerchanged;
     var saw_message = new Promise(function(resolve) {
         onmessage = function(e) {
             var message = e.data;
             assert_equals(
                 message, 'PASS',
diff --git a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-using-registration.https.html b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-using-registration.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-using-registration.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-using-registration.https.html
@@ -2,17 +2,17 @@
 <title>Service Worker: Skip waiting using registration</title>
 <script src="/resources/testharness.js"></script>
 <script src="resources/testharness-helpers.js"></script>
 <script src="/resources/testharnessreport.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 
 promise_test(function(t) {
-    var scope = 'resources/blank.html';
+    var scope = 'resources/blank.html?skip-waiting-using-registration';
     var url1 = 'resources/empty.js';
     var url2 = 'resources/skip-waiting-worker.js';
     var frame, frame_sw, sw_registration, oncontrollerchanged;
     var saw_controllerchanged = new Promise(function(resolve) {
         oncontrollerchanged = function(e) {
             assert_equals(e.type, 'controllerchange',
                           'Event name should be "controllerchange"');
             assert_true(
diff --git a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-without-using-registration.https.html b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-without-using-registration.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/skip-waiting-without-using-registration.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/skip-waiting-without-using-registration.https.html
@@ -2,17 +2,17 @@
 <title>Service Worker: Skip waiting without using registration</title>
 <script src="/resources/testharness.js"></script>
 <script src="resources/testharness-helpers.js"></script>
 <script src="/resources/testharnessreport.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 
 promise_test(function(t) {
-    var scope = 'resources/blank.html';
+    var scope = 'resources/blank.html?skip-waiting-without-using-registration';
     var url = 'resources/skip-waiting-worker.js';
     var frame, frame_sw, sw_registration;
 
     return service_worker_unregister(t, scope)
       .then(function() {
           return with_iframe(scope);
         })
       .then(function(f) {
diff --git a/testing/web-platform/tests/service-workers/service-worker/skip-waiting.https.html b/testing/web-platform/tests/service-workers/service-worker/skip-waiting.https.html
--- a/testing/web-platform/tests/service-workers/service-worker/skip-waiting.https.html
+++ b/testing/web-platform/tests/service-workers/service-worker/skip-waiting.https.html
@@ -2,17 +2,17 @@
 <title>Service Worker: Skip waiting</title>
 <script src="/resources/testharness.js"></script>
 <script src="resources/testharness-helpers.js"></script>
 <script src="/resources/testharnessreport.js"></script>
 <script src="resources/test-helpers.sub.js"></script>
 <script>
 
 promise_test(function(t) {
-    var scope = 'resources/blank.html';
+    var scope = 'resources/blank.html?skip-waiting';
     var url1 = 'resources/empty.js';
     var url2 = 'resources/empty-worker.js';
     var url3 = 'resources/skip-waiting-worker.js';
     var frame, sw_registration, activated_worker, waiting_worker;
     return service_worker_unregister_and_register(t, url1, scope)
       .then(function(registration) {
           sw_registration = registration;
           return wait_for_state(t, registration.installing, 'activated');
