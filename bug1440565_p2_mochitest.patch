# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  adf943761617c46163109da936ecc416179824ed
Bug 1440565 P2 Add a mochitest that verifies we throw TypeError for fetch() with a view-source URL. r=asuth

diff --git a/dom/tests/mochitest/fetch/test_fetch_basic.js b/dom/tests/mochitest/fetch/test_fetch_basic.js
--- a/dom/tests/mochitest/fetch/test_fetch_basic.js
+++ b/dom/tests/mochitest/fetch/test_fetch_basic.js
@@ -108,17 +108,27 @@ function testRequestMozErrors() {
   const r = new Request("http://localhost:4/should/fail", { mozErrors: true });
   return fetch(r).then(res => {
     ok(false, "Request should not succeed");
   }).catch(err => {
     ok(err instanceof TypeError);
   });
 }
 
+function testViewSourceURL() {
+  var p2 = fetch('view-source:/').then(function(res) {
+    ok(false, "view-source: URL should fail");
+  }, function(e) {
+    ok(e instanceof TypeError, "view-source: URL should fail");
+  });
+}
+
 function runTest() {
   return Promise.resolve()
     .then(testAboutURL)
     .then(testDataURL)
     .then(testSameOriginBlobURL)
     .then(testNonGetBlobURL)
     .then(testMozErrors)
+    .then(testRequestMozErrors)
+    .then(testViewSourceURL)
     // Put more promise based tests here.
 }
