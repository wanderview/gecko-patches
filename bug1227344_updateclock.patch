# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  2dfb45d74f42d2a0010696f5fd47c7a7da94cedb
Bug 1227344 Try to ensure script content is always different in update tests by using .clock(). r=jdm

diff --git a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-nocookie-worker.py b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-nocookie-worker.py
--- a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-nocookie-worker.py
+++ b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-nocookie-worker.py
@@ -4,11 +4,12 @@ def main(request, response):
     # no-cache itself to ensure the user agent finds a new version for each update.
     headers = [('Cache-Control', 'no-cache, must-revalidate'),
                ('Pragma', 'no-cache')]
 
     # Set a normal mimetype.
     content_type = 'application/javascript'
 
     headers.append(('Content-Type', content_type))
-    # Return a different script for each access.
-    return headers, '// %s' % (time.time())
+    # Return a different script for each access.  Use .time() and .clock() for
+    # best time resolution across different platforms.
+    return headers, '// %s %s' % (time.time(), time.clock())
 
diff --git a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-worker.py b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-worker.py
--- a/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-worker.py
+++ b/testing/web-platform/mozilla/tests/service-workers/service-worker/resources/update-worker.py
@@ -35,11 +35,12 @@ def main(request, response):
         extra_body = 'badsyntax(isbad;'
     elif mode == 'throw-install':
         # Unset and delete cookie to clean up the test setting.
         content_type = 'application/javascript'
         response.delete_cookie('mode')
         extra_body = "addEventListener('install', function(e) { throw new Error('boom'); });"
 
     headers.append(('Content-Type', content_type))
-    # Return a different script for each access.
-    return headers, '/* %s */ %s' % (time.time(), extra_body)
+    # Return a different script for each access.  Use .time() and .clock() for
+    # best time resolution across different platforms.
+    return headers, '/* %s %s */ %s' % (time.time(), time.clock(), extra_body)
 
