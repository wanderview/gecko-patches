# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  a1febd284f30842fd58d838801e9b6c6042e7fda

diff --git a/dom/base/nsGlobalWindow.cpp b/dom/base/nsGlobalWindow.cpp
--- a/dom/base/nsGlobalWindow.cpp
+++ b/dom/base/nsGlobalWindow.cpp
@@ -13207,23 +13207,44 @@ nsGlobalWindow::InsertTimeoutIntoList(ns
 
   aTimeout->mFiringDepth = 0;
 
   // Increment the timeout's reference count since it's now held on to
   // by the list
   aTimeout->AddRef();
 }
 
+namespace {
+
+class TimerCallbackRunnable final : public Runnable
+{
+  RefPtr<nsTimeout> mTimeout;
+public:
+  explicit TimerCallbackRunnable(nsTimeout* aTimeout)
+    : mTimeout(aTimeout)
+  { }
+
+  NS_IMETHOD
+  Run()
+  {
+    mTimeout->mWindow->RunTimeout(mTimeout);
+    return NS_OK;
+  }
+};
+
+} // anonymous namespace
+
 // static
 void
 nsGlobalWindow::TimerCallback(nsITimer *aTimer, void *aClosure)
 {
   RefPtr<nsTimeout> timeout = (nsTimeout *)aClosure;
 
-  timeout->mWindow->RunTimeout(timeout);
+  nsCOMPtr<nsIRunnable> r = new TimerCallbackRunnable(timeout);
+  NS_DispatchToMainThread(r.forget());
 }
 
 // static
 void
 nsGlobalWindow::TimerNameCallback(nsITimer* aTimer, void* aClosure, char* aBuf,
                                   size_t aLen)
 {
   RefPtr<nsTimeout> timeout = (nsTimeout*)aClosure;
