# HG changeset patch
# User Ben Kelly <ben@wanderview.com>
# Parent  21f09d7e7214eaebf1e0980494159bd846e1bdd9
Bug 1460881 Add diagnostic assert to HttpChannelChild verifying the LoadInfo can be deserialized. r=valentin

diff --git a/netwerk/protocol/http/HttpChannelChild.cpp b/netwerk/protocol/http/HttpChannelChild.cpp
--- a/netwerk/protocol/http/HttpChannelChild.cpp
+++ b/netwerk/protocol/http/HttpChannelChild.cpp
@@ -2750,16 +2750,26 @@ HttpChannelChild::ContinueAsyncOpen()
 
   openArgs.allowStaleCacheContent() = mAllowStaleCacheContent;
 
   openArgs.contentTypeHint() = mContentTypeHint;
 
   nsresult rv = mozilla::ipc::LoadInfoToLoadInfoArgs(mLoadInfo, &openArgs.loadInfo());
   NS_ENSURE_SUCCESS(rv, rv);
 
+#ifdef MOZ_DIAGNOSTIC_ASSERT_ENABLED
+  // Verify that we should be able to deserialize the LoadInfo again.
+  // This is a diagnostic check to help track down parent side crashes
+  // like bug 1459655.
+  nsCOMPtr<nsILoadInfo> tmp;
+  rv = mozilla::ipc::LoadInfoArgsToLoadInfo(openArgs.loadInfo(),
+                                            getter_AddRefs(tmp));
+  MOZ_DIAGNOSTIC_ASSERT(NS_SUCCEEDED(rv));
+#endif
+
   EnsureRequestContextID();
   openArgs.requestContextID() = mRequestContextID;
 
   openArgs.corsMode() = mCorsMode;
   openArgs.redirectMode() = mRedirectMode;
 
   openArgs.channelId() = mChannelId;
 
